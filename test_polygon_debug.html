<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polygon Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        .test-button:hover {
            background-color: #0056b3;
        }
        .test-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .log-area {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status.error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .status.info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Polygon Debug Test Tool</h1>
        <p>Tool n√†y gi√∫p debug ch·ª©c nƒÉng v·∫Ω polygon trong ·ª©ng d·ª•ng React Native v·ªõi Krpano.</p>
        
        <div class="test-section">
            <h3>üìä Tr·∫°ng Th√°i H·ªá Th·ªëng</h3>
            <div id="systemStatus" class="status info">
                ƒêang ki·ªÉm tra tr·∫°ng th√°i...
            </div>
            <button class="test-button" onclick="checkSystemStatus()">Ki·ªÉm Tra Tr·∫°ng Th√°i</button>
        </div>

        <div class="test-section">
            <h3>üß™ Test C∆° B·∫£n</h3>
            <button class="test-button" onclick="testHotspot()">Test Hotspot ƒê∆°n Gi·∫£n</button>
            <button class="test-button" onclick="testPolygon()">Test Polygon ƒê∆°n Gi·∫£n</button>
            <button class="test-button" onclick="createTestPolygon()">T·∫°o Polygon Test</button>
        </div>

        <div class="test-section">
            <h3>üîç Debug Polygon</h3>
            <input type="text" id="shapeId" placeholder="Nh·∫≠p Shape ID (v√≠ d·ª•: poly_1)" value="poly_1" style="padding: 5px; margin: 5px;">
            <button class="test-button" onclick="debugShapeCoordinates()">Debug T·ªça ƒê·ªô Shape</button>
            <button class="test-button" onclick="recreatePolygon()">T·∫°o L·∫°i Polygon</button>
        </div>

        <div class="test-section">
            <h3>üìù Log & Debug</h3>
            <button class="test-button" onclick="clearLog()">X√≥a Log</button>
            <button class="test-button" onclick="exportLog()">Xu·∫•t Log</button>
            <div id="logArea" class="log-area"></div>
        </div>

        <div class="test-section">
            <h3>üìö H∆∞·ªõng D·∫´n S·ª≠ D·ª•ng</h3>
            <ol>
                <li><strong>Ki·ªÉm tra tr·∫°ng th√°i:</strong> ƒê·∫£m b·∫£o Krpano ƒë√£ s·∫µn s√†ng</li>
                <li><strong>Test c∆° b·∫£n:</strong> T·∫°o hotspot v√† polygon ƒë∆°n gi·∫£n ƒë·ªÉ ki·ªÉm tra</li>
                <li><strong>V·∫Ω polygon:</strong> S·ª≠ d·ª•ng ·ª©ng d·ª•ng ƒë·ªÉ v·∫Ω polygon</li>
                <li><strong>Debug:</strong> S·ª≠ d·ª•ng c√°c h√†m debug ƒë·ªÉ ki·ªÉm tra t·ªça ƒë·ªô</li>
                <li><strong>T·∫°o l·∫°i:</strong> S·ª≠ d·ª•ng recreate n·∫øu polygon b·ªã sai v·ªã tr√≠</li>
            </ol>
        </div>
    </div>

    <script>
        // Log function
        function log(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logEntry.textContent = `[${timestamp}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
            
            // Also log to console
            console.log(`[${timestamp}] ${message}`);
        }

        // Check system status
        function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            
            try {
                if (typeof krpano !== 'undefined') {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ Krpano ƒë√£ s·∫µn s√†ng';
                    log('Krpano ƒë√£ s·∫µn s√†ng', 'success');
                    
                    // Check if our debug functions are available
                    if (window.debugShapeCoordinates && window.createTestPolygon) {
                        log('‚úÖ C√°c h√†m debug ƒë√£ s·∫µn s√†ng', 'success');
                    } else {
                        log('‚ö†Ô∏è C√°c h√†m debug ch∆∞a s·∫µn s√†ng', 'error');
                    }
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå Krpano ch∆∞a s·∫µn s√†ng';
                    log('Krpano ch∆∞a s·∫µn s√†ng', 'error');
                }
            } catch (e) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå L·ªói ki·ªÉm tra: ' + e.message;
                log('L·ªói ki·ªÉm tra: ' + e.message, 'error');
            }
        }

        // Test basic hotspot
        function testHotspot() {
            try {
                if (typeof window.testHotspot === 'function') {
                    window.testHotspot();
                    log('‚úÖ Test hotspot ƒë√£ ch·∫°y', 'success');
                } else {
                    log('‚ùå H√†m testHotspot kh√¥ng c√≥ s·∫µn', 'error');
                }
            } catch (e) {
                log('‚ùå L·ªói test hotspot: ' + e.message, 'error');
            }
        }

        // Test basic polygon
        function testPolygon() {
            try {
                if (typeof window.testPolygon === 'function') {
                    window.testPolygon();
                    log('‚úÖ Test polygon ƒë√£ ch·∫°y', 'success');
                } else {
                    log('‚ùå H√†m testPolygon kh√¥ng c√≥ s·∫µn', 'error');
                }
            } catch (e) {
                log('‚ùå L·ªói test polygon: ' + e.message, 'error');
            }
        }

        // Create test polygon
        function createTestPolygon() {
            try {
                if (typeof window.createTestPolygon === 'function') {
                    window.createTestPolygon();
                    log('‚úÖ T·∫°o polygon test ƒë√£ ch·∫°y', 'success');
                } else {
                    log('‚ùå H√†m createTestPolygon kh√¥ng c√≥ s·∫µn', 'error');
                }
            } catch (e) {
                log('‚ùå L·ªói t·∫°o polygon test: ' + e.message, 'error');
            }
        }

        // Debug shape coordinates
        function debugShapeCoordinates() {
            try {
                const shapeId = document.getElementById('shapeId').value;
                if (!shapeId) {
                    log('‚ùå Vui l√≤ng nh·∫≠p Shape ID', 'error');
                    return;
                }
                
                if (typeof window.debugShapeCoordinates === 'function') {
                    window.debugShapeCoordinates(shapeId);
                    log('‚úÖ Debug t·ªça ƒë·ªô shape: ' + shapeId, 'success');
                } else {
                    log('‚ùå H√†m debugShapeCoordinates kh√¥ng c√≥ s·∫µn', 'error');
                }
            } catch (e) {
                log('‚ùå L·ªói debug shape: ' + e.message, 'error');
            }
        }

        // Recreate polygon
        function recreatePolygon() {
            try {
                const shapeId = document.getElementById('shapeId').value;
                if (!shapeId) {
                    log('‚ùå Vui l√≤ng nh·∫≠p Shape ID', 'error');
                    return;
                }
                
                if (typeof window.recreatePolygonFromShape === 'function') {
                    window.recreatePolygonFromShape(shapeId);
                    log('‚úÖ T·∫°o l·∫°i polygon: ' + shapeId, 'success');
                } else {
                    log('‚ùå H√†m recreatePolygonFromShape kh√¥ng c√≥ s·∫µn', 'error');
                }
            } catch (e) {
                log('‚ùå L·ªói t·∫°o l·∫°i polygon: ' + e.message, 'error');
            }
        }

        // Clear log
        function clearLog() {
            document.getElementById('logArea').innerHTML = '';
            log('Log ƒë√£ ƒë∆∞·ª£c x√≥a');
        }

        // Export log
        function exportLog() {
            const logArea = document.getElementById('logArea');
            const logText = logArea.innerText;
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'polygon_debug_log.txt';
            a.click();
            URL.revokeObjectURL(url);
            log('Log ƒë√£ ƒë∆∞·ª£c xu·∫•t');
        }

        // Auto-check status when page loads
        window.addEventListener('load', function() {
            setTimeout(checkSystemStatus, 1000);
        });

        // Log page load
        log('üîß Polygon Debug Test Tool ƒë√£ s·∫µn s√†ng');
        log('üì± H√£y m·ªü ·ª©ng d·ª•ng React Native v√† v·∫Ω polygon tr∆∞·ªõc');
        log('üîç Sau ƒë√≥ s·ª≠ d·ª•ng c√°c h√†m debug ƒë·ªÉ ki·ªÉm tra');
    </script>
</body>
</html>
